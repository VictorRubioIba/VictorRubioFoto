<div class="mx-auto mb-16 mt-12 max-w-screen-2xl sm:px-6">
  <div class="gallery" style="visibility: hidden; height: 1px; overflow: hidden">
    {{ $photos := sort (.Resources.ByType "image") (index .Params "sort_by" | default "Name") (.Params.sort_order | default "asc") }}
    {{ range $index, $original := $photos }}
      {{ if eq $original.ResourceType "image" }}
        {{ $metadata := dict }}
        {{ with $original.Exif }}
          {{ $metadata = merge .Tags $metadata }}
        {{ end }}
        {{ $rotation := "" }}
        {{ with $metadata.Orientation }}
          {{ if or (eq . 8) (eq . 7) }}
            {{ $rotation = " r90" }}
          {{ else if or (eq . 3) (eq . 4) }}
            {{ $rotation = " r180" }}
          {{ else if or (eq . 6) (eq . 5) }}
            {{ $rotation = " r270" }}
          {{ end }}
        {{ end }}
        {{ $title := "" }}
        {{ with $metadata.ImageDescription }}
          {{ $title = . }}
        {{ end }}
        {{ if ne $original.Title $original.Name }}
          {{ $title = $original.Title }}
        {{ end }}
        {{ $thumbnail := ($original.Fit (printf "%s %s" "600x600" $rotation)) }}
        {{ $full := ($original.Fit (printf "%s %s" "1600x1600" $rotation)) }}
        {{ $color := index $thumbnail.Colors 0 | default "transparent" }}
        <a class="gallery-item cursor-zoom-in" href="{{ $original.RelPermalink }}" data-pswp-src="{{ $full.RelPermalink }}" data-pswp-width="{{ $full.Width }}" data-pswp-height="{{ $full.Height }}" title="{{ $title }}" itemscope itemtype="https://schema.org/ImageObject" style="aspect-ratio: {{ $thumbnail.Width }} / {{ $thumbnail.Height }}">
          <img loading="lazy" width="{{ $thumbnail.Width }}" height="{{ $thumbnail.Height }}" src="{{ $thumbnail.RelPermalink }}" style="background-color: {{ $color }}" alt="{{ $title }}" />
          <meta itemprop="contentUrl" content="{{ $original.RelPermalink }}" />
          {{ with $.Site.Author }}
            <span itemprop="creator" itemtype="https://schema.org/Person" itemscope>
              <meta itemprop="name" content="{{ $.Site.Author.name }}" />
            </span>
          {{ end }}
        </a>
      {{ end }}
    {{ end }}
  </div>
</div>
